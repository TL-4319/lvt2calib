# Information for running this tool set with LAGER setup
## Dependencies
- Docker
- ROS Noetic image

## Pre requisite
Intrinsic calibration of all cameras need to be performed beforehand. The resulting intrinsic matrix needs to be saved in ```lvt2calib/data/camera_info/<camera_name>.txt``` with the following format

```
K: fx 0.0 cx 0.0 fy cy 0.0 0.0 1.0
D: k1 k2 p1 p2 k3
```

## Data collection
Save stuff as raw files and csv and convert to bag later [FILE 2 BAG CONVERTER NEED DEV]

## Running LVT2Calib
Need osrf/ros:noetic-desktop-full. All terminal start from ```lvt2calib/docker``` directory, run

### Terminal 1
In terminal 1, start roscore
```
sudo bash start_noetic_docker.sh
```

Within the container
```
roscore
```

### Terminal 2
In terminal 2, the recorded data can be playback as rosbag

```
sudo bash start_noetic_docker.sh
```

Within the container
```
rosbag play -l <data>.bag
```

### LVT2Calib docker containers
We run the needed code for LVT2Calib using several containers each can be started by running

```
sudo bash priv_run.sh
```

Note that within the container, autocompletion is available for ros processes parameter. Hit ```Tab``` to list available options. Default values for all process is found in ```lvt2calib/launch/```
 #### Point cloud pattern detection
 Start a lvt2calib container.

 Following the original doc, start the process via

 ```
 roslaunch lvt2calib (ns_lidar)_pattern.launch cloud_tp:=(your_lidar_topic) ns_:=(ns_lidar)
 ```

 Board detection can be verified using the started rviz instance

 #### RGB/Thermal Camera pattern detection
 Start a lvt2calib container.

 Following the original doc, start the process via

 ```
 roslaunch lvt2calib (ns_camera)_pattern.launch image_tp:=(your_img_yp) ifCompressed:=(true or false) isDarkBoard:=(true or false) ns_:=(ns_camera) cam_info_dir:=(your_camera_param_filepath)
 ```

#### Pattern collection
Start a lvt2calib container.

This process collect the detection from cameras/lidar streams from other containers and write the detections into a file for extrinsic calibration. Collection can be done for multiple target locations. The paper recommend more than 9 locations. The detections are saved in ```lvt2calib/data/pattern_collection_result/``` as ```pattern_res.csv```

Following the original doc, start the process via
```
roslaunch lvt2calib pattern_collection_lc.launch ns_l:=(ns_lidar) ns_c:=(ns_camera)
```

The program will prompt for an input to start the process. Send ```Y``` to begin. The program will collect 60 samples per sequence (ensure everything is static during collection). Once completed, it will ask for another sequence with the target being at the different location.

#### Extrinsics calibration
Start a lvt2calib container.

Following the original doc, start the process via
```
roslaunch lvt2calib extrinsic_calib_l2c.launch ns_l:=(ns_lidar) ns_c:=(ns_camera)
```
For configuration paramters

```cam_info_filename``` - name of camera intrinsics filename. Already targeted ```lvt2calib/data/camera_info``` directory so yo will just need to enter ```<camera_name>.txt```

```featureFileName``` - name of the output file generated by pattern collection process. Already targeted ```lv2calib/data/pattern_collection_result``` and will auto matically append ```csv``` to output name so you just need to enter ```pattern_res```